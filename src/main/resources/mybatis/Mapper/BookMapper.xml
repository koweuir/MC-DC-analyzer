<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ctc.library.dao.BookDao">
    <insert id="insertBook">
        INSERT INTO book
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="bookId != null">bookId,</if>
            <if test="bookName != null">bookName,</if>
            <if test="publicationTime != null">publicationTime,</if>
            <if test="author != null">author,</if>
            <if test="publisher != null">publisher,</if>
            <if test="category != null">category,</if>
            <if test="pageNumber != null">pageNumber,</if>
            <if test="price != null">price,</if>
            <if test="bookPicturePath != null">bookPicturePath,</if>
            <if test="bookStatus != null">bookStatus,</if>
            <if test="unitName != null">unitName,</if>
            <if test="permission != null">permission,</if>
            <if test="bookCirculation != null">bookCirculation,</if>
        </trim>
        VALUES
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="bookId != null">#{bookId},</if>
            <if test="bookName != null">#{bookName},</if>
            <if test="publicationTime != null">#{publicationTime},</if>
            <if test="author != null">#{author},</if>
            <if test="publisher != null">#{publisher},</if>
            <if test="category != null">#{category},</if>
            <if test="pageNumber != null">#{pageNumber},</if>
            <if test="price != null">#{price},</if>
            <if test="bookPicturePath != null">#{bookPicturePath},</if>
            <if test="bookStatus != null">#{bookStatus},</if>
            <if test="unitName != null">#{unitName},</if>
            <if test="permission != null">#{permission},</if>
            <if test="bookCirculation != null">#{bookCirculation},</if>
        </trim>
    </insert>
    <update id="updateAll">
        UPDATE book
        <set>
            <if test="bookName != null">bookName = #{bookName},</if>
            <if test="publicationTime != null">publicationTime = #{publicationTime},</if>
            <if test="author != null">author = #{author},</if>
            <if test="publisher != null">publisher = #{publisher},</if>
            <if test="category != null">category = #{category},</if>
            <if test="pageNumber != null">pageNumber = #{pageNumber},</if>
            <if test="price != null">price = #{price},</if>
            <if test="bookPicturePath != null">bookPicturePath = #{bookPicturePath},</if>
            <if test="bookStatus != null">bookStatus = #{bookStatus},</if>
            <if test="unitName != null">unitName = #{unitName},</if>
            <if test="permission != null">permission = #{permission},</if>
            <if test="bookCirculation != null">bookCirculation = #{bookCirculation},</if>
        </set>
        WHERE bookId = #{bookId}
    </update>
    <delete id="deleteByBookNo">
        DELETE FROM book WHERE bookId = #{bookId}
    </delete>
    <select id="selectAllBooks" resultType="com.ctc.library.entity.Book">
        SELECT * FROM book  where bookName like concat('%', #{bookName} ,'%')
                            and bookId like concat('%', #{bookId} ,'%')
                            and author like concat('%', #{author} ,'%')
                            and publisher like concat('%', #{publisher} ,'%')
        LIMIT #{pageNum}, #{pageSize}
    </select>
    <select id="selectTotal" resultType="java.lang.Integer">
        select count(*) from book where bookName like concat('%', #{bookName} ,'%')
                                and bookId like concat('%', #{bookId} ,'%')
                                and author like concat('%', #{author} ,'%')
                                and publisher like concat('%', #{publisher} ,'%')
    </select>
    <select id="selectBookByNo" resultType="com.ctc.library.entity.Book">
        select * FROM book where bookId = #{bookId}
    </select>
    <select id="selectPermissionAllBooks" resultType="com.ctc.library.entity.Book">
        SELECT * FROM book  where bookName like concat('%', #{bookName} ,'%')
                              and bookId like concat('%', #{bookId} ,'%')
                              and author like concat('%', #{author} ,'%')
                              and publisher like concat('%', #{publisher} ,'%')
                              and (unitName = #{unitName} || permission = #{permission})
        LIMIT #{pageNum}, #{pageSize}
    </select>
    <select id="selectPermissionTotal" resultType="java.lang.Integer">
        select count(*) from book where bookName like concat('%', #{bookName} ,'%')
                                    and bookId like concat('%', #{bookId} ,'%')
                                    and author like concat('%', #{author} ,'%')
                                    and publisher like concat('%', #{publisher} ,'%')
                                    and (unitName = #{unitName} || permission = #{permission})
    </select>
    <select id="countBook" resultType="java.lang.Integer">
        select count(*) from book
        <where>
            <if test="unitName != null and unitName != ''">
                and unitName = #{unitName}
            </if>
            <if test="bookStatus != null and bookStatus != ''">
                and bookStatus = #{bookStatus}
            </if>
        </where>
    </select>
    <select id="getBookByUnit" resultType="com.ctc.library.entity.Book">
        select * FROM book where unitName = #{unitName}
    </select>

</mapper>